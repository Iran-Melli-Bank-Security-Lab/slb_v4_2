import { React, useEffect, useState } from "react";
import { Avatar, Box, Button, Checkbox, Divider, Modal, Typography } from "@mui/material";
import { getUsers } from "../../../api/users/getUsers";

export default function AssignPentester({ open, onClose, project }) {
    
    const [users, setUsers] = useState([]);
    const [selectedPentesters, setSelectedPentesters] = useState([]);

    useEffect(() => {

        async function fetchUsers() {
            const res = await getUsers()
            console.log("get users : ", res)
            setUsers(res.users)
        }
        fetchUsers()

    }, [])
    const isUserSelected = (userId) => selectedPentesters.includes(userId);


    return <>
        <Modal
            open={open}
            onClose={onClose}
            aria-labelledby="assign-modal-title"
            aria-describedby="assign-modal-description"
        >
            <Box
                sx={{
                    position: 'absolute',
                    top: '50%',
                    left: '50%',
                    transform: 'translate(-50%, -50%)',
                    width: 400,
                    bgcolor: 'background.paper',
                    border: '2px solid #000',
                    boxShadow: 24,
                    p: 4,
                    borderRadius: 2,
                }}
            >
                <Typography id="assign-modal-title" variant="h6" component="h2" gutterBottom>
                    Assign Users
                </Typography>
                <Typography id="assign-modal-description" sx={{ mb: 2 }}>
                    Select users to assign to the project.
                </Typography>
                <div>
                    {users.map((user) => (
                        <main key={user._id}>
                            <div className="flex items-center justify-between mb-2">
                                <div className="flex items-center space-x-2">
                                    <Checkbox
                                        checked={isUserSelected(user._id)}
                                        onChange={() => handleUserToggle(user._id)}
                                    />
                                    <Box display="flex" alignItems="center">
                                        <Avatar
                                            src={`http://localhost:4000${user.profileImageUrl}`}
                                            alt={user.firstName}
                                            sx={{ marginRight: 2 }}
                                        />
                                        <Typography>{user.lastName}</Typography>
                                    </Box>
                                </div>
                                <Button
                                    variant="outlined"
                                    size="small"
                                    onClick={() => handleBugScopeClick(user._id, user, selectedProject)}
                                    disabled={!isUserSelected(user._id)}
                                >
                                    Bug Scope
                                </Button>
                            </div>
                            <Divider className="my-1" />
                        </main>
                    ))}
                </div>
            </Box>
        </Modal>

    </>
}

const data1 = [
    {
        "id": "4.1",
        "label": "Information Gathering",
        "labelfa": "جمع آوری اطلاعات",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.1.1",
                "label": "Conduct Search Engine Discovery Reconnaissance for Information Leakage",
                "labelfa": "آزمون استفاده از موتور جستوجو / به منظور نشت اطلاعات",
                "wstg": "INFO-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.1.2",
                "label": "Fingerprint Web Server",
                "labelfa": "آزمون انگشت‌ نگاری سرویس دهنده وب",
                "wstg": "INFO-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.1.3",
                "label": "Review Webserver Metafiles for Information Leakage",
                "labelfa": "آزمون بازبینی Metafile های سرویس دهنده وب برای نشت اطلاعات",
                "wstg": "INFO-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.1.4",
                "label": "Enumerate Applications on Webserver",
                "labelfa": "آزمون برشماری برنامه‌های کاربردی بر روی سرویس دهنده وب",
                "wstg": "INFO-04",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.1.5",
                "label": "Review Web Page Content for Information Leakage",
                "labelfa": "آزمون بازبینی توضیحات و فراداده‌های صفحات وب برای نشت اطلاعات",
                "wstg": "INFO-05",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.1.6",
                "label": "Identify Application Entry Points",
                "labelfa": "آزمون شناسایی نقاط ورودی برنامه‌کاربردی",
                "wstg": "INFO-06",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.1.7",
                "label": "Map Execution Paths Through Application",
                "labelfa": "آزمون نقشه‌کشی مسیرهای اجرایی در برنامه کاربردی",
                "wstg": "INFO-07",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.1.8",
                "label": "Fingerprint Web Application Framework",
                "labelfa": "آزمون انگشت‌نگاری چارچوب برنامه‌ی کاربردی",
                "wstg": "INFO-08",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.1.9",
                "label": "Fingerprint Web Application",
                "labelfa": "آزمون انگشت‌نگاری برنامه‌ی کاربردی وب",
                "wstg": "INFO-09",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.1.10",
                "label": "Map Application Architecture",
                "labelfa": "آزمون نقشه‌کشی معماری برنامه‌ی کاربردی",
                "wstg": "INFO-10",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b41b"
    },
    {
        "id": "4.2",
        "label": "Configuration and Deployment Management Testing",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.2.1",
                "label": "Test Network Infrastructure Configuration",
                "labelfa": "آزمون پیکربندی شبکه/‌زیرساخت",
                "wstg": "CONF-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.2",
                "label": "Test Application Platform Configuration",
                "labelfa": "آزمون پیکربندی بستر برنامه کاربردی",
                "wstg": "CONF-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.3",
                "label": "Test File Extensions Handling for Sensitive Information",
                "labelfa": "آزمون مدیریت پسوند فایل ها برای داده‌های حساس",
                "wstg": "CONF-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.4",
                "label": "Review Old Backup and Unreferenced Files for Sensitive Information",
                "labelfa": "آزمون بررسی فایل های پشتیبان قدیمی و بی‌مرجع برای داده ‌های حساس",
                "wstg": "CONF-04",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.5",
                "label": "Enumerate Infrastructure and Application Admin Interfaces",
                "labelfa": "آزمون برشماری واسط‌های مدیریتی زیرساخت و برنامه",
                "wstg": "CONF-05",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.6",
                "label": "Test HTTP Methods",
                "labelfa": "آزمون روش های HTTP",
                "wstg": "CONF-06",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.7",
                "label": "Test HTTP Strict Transport Security",
                "labelfa": "آزمون HSTS",
                "wstg": "CONF-07",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.8",
                "label": "Test RIA Cross Domain Policy",
                "labelfa": "آزمون سیاست‌های بین دامنه‌ای RIA ",
                "wstg": "CONF-08",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.9",
                "label": "Test File Permission",
                "labelfa": "آزمون مجوز فایل ",
                "wstg": "CONF-09",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.10",
                "label": "Test for Subdomain Takeover",
                "labelfa": "آزمون تصاحب زیردامنه",
                "wstg": "CONF-10",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.11",
                "label": "Test Cloud Storage",
                "labelfa": "آزمون فضای ذخیره‌سازی ابری",
                "wstg": "CONF-11",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.12",
                "label": "Test for Content Security Policy",
                "labelfa": "آزمون CSP",
                "wstg": "CONF-12",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.2.13",
                "label": "Test for Path Confusion",
                "labelfa": "آزمون Path Confusion",
                "wstg": "CONF-13",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b41c"
    },
    {
        "id": "4.3",
        "label": "Identity Management Testing",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.3.1",
                "label": "Test Role Definitions",
                "labelfa": "آزمون تعریف نقش‌های سامانه",
                "wstg": "IDNT-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.3.2",
                "label": "Test User Registration Process",
                "labelfa": "آزمون فرآیند ثبت‌نام کاربر",
                "wstg": "IDNT-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.3.3",
                "label": "Test Account Provisioning Process",
                "labelfa": "آزمون فرآیند تأمین حساب کاربری",
                "wstg": "IDNT-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.3.4",
                "label": "Testing for Account Enumeration and Guessable User Account",
                "labelfa": "آزمون برشماری حساب‌های کاربری و نام‌های کاربری قابل حدس",
                "wstg": "IDNT-04",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.3.5",
                "label": "Testing for Weak or Unenforced Userlabel Policy",
                "labelfa": "آزمون سیاست انتخاب نام کاربری ضعیف یا غیرقابل اجرا",
                "wstg": "IDNT-05",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b41d"
    },
    {
        "id": "4.4",
        "label": "Authentication Testing",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.4.1",
                "label": "Testing for Credentials Transported over an Encrypted Channel",
                "labelfa": "آزمون انتقال اطلاعات حساب کاربری از طریق کانال رمزگذاری شده",
                "wstg": "ATHN-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.2",
                "label": "Testing for Default Credentials",
                "labelfa": "آزمون بررسی اعتبارنامه‌های پیش فرض",
                "wstg": "ATHN-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.3",
                "label": "Testing for Weak Lock Out Mechanism",
                "labelfa": "آزمون سازوکار ضعیف مسدودسازی",
                "wstg": "ATHN-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.4",
                "label": "Testing for Bypassing Authentication Schema",
                "labelfa": "آزمون دور زدن شمای احرازهویت",
                "wstg": "ATHN-04",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.5",
                "label": "Testing for Vulnerable Remember Password",
                "labelfa": "آزمون سازوکار گذرواژه حفظ شده",
                "wstg": "ATHN-05",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.6",
                "label": "Testing for Browser Cache Weaknesses",
                "labelfa": "آزمون نقاط ضعف حافظه پنهان مرورگر",
                "wstg": "ATHN-06",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.7",
                "label": "Testing for Weak Password Policy",
                "labelfa": "آزمون سیاست گذرواژه ضعیف",
                "wstg": "ATHN-07",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.8",
                "label": "Testing for Weak Security Question Answer",
                "labelfa": "آزمون پرسش/پاسخ امنیتی ضعیف",
                "wstg": "ATHN-08",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.9",
                "label": "Testing for Weak Password Change or Reset Functionalities",
                "labelfa": "آزمون عملکردهای ضعیف بازنشانی یا تغییر گذرواژه",
                "wstg": "ATHN-09",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.10",
                "label": "Testing for Weaker Authentication in Alternative Channel",
                "labelfa": "آزمون احراز هویت ضعیف در کانال‌های جایگزین",
                "wstg": "ATHN-10",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.4.11",
                "label": "Testing Multi-Factor Authentication",
                "labelfa": "آزمون احراز هویت چندعاملی(MAF)",
                "wstg": "ATHN-11",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b41e"
    },
    {
        "id": "4.5",
        "label": "Authorization Testing",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.5.1",
                "label": "Testing Directory Traversal File Include",
                "labelfa": "آزمون پیمایش مسیر پوشه‌ها و فایل‌های آن",
                "wstg": "ATHZ-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.5.2",
                "label": "Testing for Bypassing Authorization Schema",
                "labelfa": "آزمون دور زدن شمای مجوز",
                "wstg": "ATHZ-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.5.3",
                "label": "Testing for Privilege Escalation",
                "labelfa": "آزمون ارتقاء سطح دسترسی",
                "wstg": "ATHZ-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.5.4",
                "label": "Testing for Insecure Direct Object References",
                "labelfa": "آزمون مراجع مستقیم ناامن به شیء",
                "wstg": "ATHZ-04",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.5.5",
                "label": "Testing for OAuth Weaknesses",
                "wstg": null,
                "status": "notAttempted",
                "children": [
                    {
                        "id": "4.5.5.1",
                        "label": "Testing for OAuth Authorization Server Weaknesses",
                        "labelfa": "آزمون ضعف‌های سرور احراز هویت OAuth",
                        "wstg": "ATHZ-05-01",
                        "status": "notAttempted",
                        "children": []
                    },
                    {
                        "id": "4.5.5.2",
                        "label": "Testing for OAuth Client Weaknesses",
                        "labelfa": "آزمون برای ضعف‌های کلاینت OAuth",
                        "wstg": "ATHZ-05-02",
                        "status": "notAttempted",
                        "children": []
                    }
                ]
            }
        ],
        "_id": "68700eb39473b8a16829b41f"
    },
    {
        "id": "4.6",
        "label": "Session Management Testing",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.6.1",
                "label": "Testing for Session Management Schema",
                "labelfa": "آزمون شمای مدیریت نشست",
                "wstg": "SESS-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.2",
                "label": "Testing for Cookies Attributes",
                "labelfa": "آزمون ویژگی کوکی‌ها",
                "wstg": "SESS-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.3",
                "label": "Testing for Session Fixation",
                "labelfa": "آزمون Session Fixation",
                "wstg": "SESS-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.4",
                "label": "Testing for Exposed Session Variables",
                "labelfa": "آزمون متغیرهای افشا شده نشست",
                "wstg": "SESS-04",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.5",
                "label": "Testing for Cross Site Request Forgery",
                "labelfa": "آزمون حمله‌ی جعل درخواست(CSRF)",
                "wstg": "SESS-05",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.6",
                "label": "Testing for Logout Functionality",
                "labelfa": "آزمون عملکرد خروج",
                "wstg": "SESS-06",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.7",
                "label": "Testing Session Timeout",
                "labelfa": "آزمون ناتمام مهلت نشست",
                "wstg": "SESS-07",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.8",
                "label": "Testing for Session Puzzling",
                "labelfa": "آزمون Session Puzzling",
                "wstg": "SESS-08",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.9",
                "label": "Testing for Session Hijacking",
                "labelfa": "آزمون Session Hijacking",
                "wstg": "SESS-09",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.10",
                "label": "Testing JSON Web Tokens",
                "labelfa": "آزمون وب توکن‌های JSON",
                "wstg": "SESS-10",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.6.11",
                "label": "Testing for Concurrent Sessions",
                "labelfa": "آزمون جلسات همزمان",
                "wstg": "SESS-11",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b420"
    },
    {
        "id": "4.7",
        "label": "Input Validation Testing",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.7.1",
                "label": "Testing for Reflected Cross Site Scripting",
                "labelfa": "آزمون XSS بازتابی",
                "wstg": "INPV-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.2",
                "label": "Testing for Stored Cross Site Scripting",
                "labelfa": "آزمون XSS ذخیره‌شده(پایا)",
                "wstg": "INPV-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.3",
                "label": "Testing for HTTP Verb Tampering",
                "labelfa": "آزمون دست‌کاری عملکرد HTTP",
                "wstg": "INPV-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.4",
                "label": "Testing for HTTP Parameter Pollution",
                "labelfa": "آزمون آلودگی پارامترهای HTTP",
                "wstg": "INPV-04",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.5",
                "label": "Testing for SQL Injection",
                "wstg": null,
                "status": "notAttempted",
                "children": [
                    {
                        "id": "4.7.5.1",
                        "label": "Testing for Oracle",
                        "labelfa": "آزمون تزریق اراکل",
                        "wstg": "INPV-05-01",
                        "status": "notAttempted",
                        "children": []
                    },
                    {
                        "id": "4.7.5.2",
                        "label": "Testing for MySQL",
                        "labelfa": "آزمون تزریق MySQL",
                        "wstg": "INPV-05-02",
                        "status": "notAttempted",
                        "children": []
                    },
                    {
                        "id": "4.7.5.3",
                        "label": "Testing for SQL Server",
                        "labelfa": "آزمون تزریق SQL Server",
                        "wstg": "INPV-05-03",
                        "status": "notAttempted",
                        "children": []
                    },
                    {
                        "id": "4.7.5.4",
                        "label": "Testing PostgreSQL",
                        "labelfa": "آزمون تزریق PostgreSQL",
                        "wstg": "INPV-05-04",
                        "status": "notAttempted",
                        "children": []
                    },
                    {
                        "id": "4.7.5.5",
                        "label": "Testing for MS Access",
                        "labelfa": "آزمون تزریق MS Access",
                        "wstg": "INPV-05-05",
                        "status": "notAttempted",
                        "children": []
                    },
                    {
                        "id": "4.7.5.6",
                        "label": "Testing for NoSQL Injection",
                        "labelfa": "آزمون تزریق NoSQL",
                        "wstg": "INPV-05-06",
                        "status": "notAttempted",
                        "children": []
                    },
                    {
                        "id": "4.7.5.7",
                        "label": "Testing for ORM Injection",
                        "labelfa": "آزمون تزریق ORM",
                        "wstg": "INPV-05-07",
                        "status": "notAttempted",
                        "children": []
                    },
                    {
                        "id": "4.7.5.8",
                        "label": "Testing for Client-side",
                        "labelfa": "آزمون Client-side",
                        "wstg": "INPV-05-08",
                        "status": "notAttempted",
                        "children": []
                    }
                ]
            },
            {
                "id": "4.7.6",
                "label": "Testing for LDAP Injection",
                "labelfa": "آزمون تزریق LDAP",
                "wstg": "INPV-06",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.7",
                "label": "Testing for XML Injection",
                "labelfa": "آزمون تزریق XML",
                "wstg": "INPV-07",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.8",
                "label": "Testing for SSI Injection",
                "labelfa": "آزمون تزریق SSI",
                "wstg": "INPV-08",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.9",
                "label": "Testing for XPath Injection",
                "labelfa": "آزمون تزریق XPath",
                "wstg": "INPV-09",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.10",
                "label": "Testing for IMAP SMTP Injection",
                "labelfa": "آزمون تزریق IMAP/SMTP",
                "wstg": "INPV-10",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.11",
                "label": "Testing for Code Injection",
                "wstg": null,
                "status": "notAttempted",
                "children": [
                    {
                        "id": "4.7.11.1",
                        "label": "Testing for Code Injection",
                        "labelfa": "آزمون تزریق کد",
                        "wstg": "INPV-11-01",
                        "status": "notAttempted",
                        "children": []
                    },
                    {
                        "id": "4.7.11.2",
                        "label": "Testing for File Inclusion",
                        "labelfa": "آزمون تزریق File Inclusion",
                        "wstg": "INPV-11-02",
                        "status": "notAttempted",
                        "children": []
                    }
                ]
            },
            {
                "id": "4.7.12",
                "label": "Testing for Command Injection",
                "labelfa": "آزمون تزریق Command",
                "wstg": "INPV-12",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.13",
                "label": "Testing for Format String Injection",
                "labelfa": "آزمون تزریق Format String",
                "wstg": "INPV-13",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.14",
                "label": "Testing for Incubated Vulnerability",
                "labelfa": "آزمون آسیب‌پذیری نهفته",
                "wstg": "INPV-14",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.15",
                "label": "Testing for HTTP Splitting Smuggling",
                "labelfa": "آزمون قاچاق HTTP Splitting",
                "wstg": "INPV-15",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.16",
                "label": "Testing for HTTP Incoming Requests",
                "labelfa": "آزمون درخواست‌های ورودیHTTP",
                "wstg": "INPV-16",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.17",
                "label": "Testing for Host Header Injection",
                "labelfa": "آزمون تزریقHost Header",
                "wstg": "INPV-17",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.18",
                "label": "Testing for Server-side Template Injection",
                "labelfa": "آزمون تزریق قالب سمت سرور",
                "wstg": "INPV-18",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.19",
                "label": "Testing for Server-Side Request Forgery",
                "labelfa": "آزمون جعل درخواست سمت سرور",
                "wstg": "INPV-19",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.7.20",
                "label": "Testing for Mass Assignment",
                "labelfa": "آزمون Mass Assignment",
                "wstg": "INPV-20",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b421"
    },
    {
        "id": "4.8",
        "label": "Testing for Error Handling",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.8.1",
                "label": "Testing for Improper Error Handling",
                "labelfa": "آزمون مدیریت نادرست خطا",
                "wstg": "ERRH-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.8.2",
                "label": "Testing for Stack Traces",
                "labelfa": "آزمون Stack Traces",
                "wstg": "ERRH-02",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b422"
    },
    {
        "id": "4.9",
        "label": "Testing for Weak Cryptography",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.9.1",
                "label": "Testing for Weak Transport Layer Security",
                "labelfa": "آزمون رمزنگاری SSL/TLS ضعیف",
                "wstg": "CRYP-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.9.2",
                "label": "Testing for Padding Oracle",
                "labelfa": "آزمون Padding Oracle",
                "wstg": "CRYP-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.9.3",
                "label": "Testing for Sensitive Information Sent via Unencrypted Channels",
                "labelfa": "آزمون ارسال اطلاعات مهم از طریق کانال رمزگذاری نشده",
                "wstg": "CRYP-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.9.4",
                "label": "Testing for Weak Encryption",
                "labelfa": "آزمون رمزنگاری ضعیف",
                "wstg": "CRYP-04",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b423"
    },
    {
        "id": "4.10",
        "label": "Business Logic Testing",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.10.1",
                "label": "Test Business Logic Data Validation",
                "labelfa": "آزمون اعتبارسنجی داده منطق کسب و کار",
                "wstg": "BUSL-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.10.2",
                "label": "Test Ability to Forge Requests",
                "labelfa": "آزمون بررسی امکان جعل درخواست",
                "wstg": "BUSL-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.10.3",
                "label": "Test Integrity Checks",
                "labelfa": "آزمون یکپارچگی داده‌ها",
                "wstg": "BUSL-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.10.4",
                "label": "Test for Process Timing",
                "labelfa": "آزمون بررسی زمان پردازش",
                "wstg": "BUSL-04",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.10.5",
                "label": "Test Number of Times a Function Can Be Used Limits",
                "labelfa": "آزمون محدودیت تعداد دفعات استفاده از یک تابع",
                "wstg": "BUSL-05",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.10.6",
                "label": "Testing for the Circumvention of Work Flows",
                "labelfa": "آزمون دور زدن جریان کاری",
                "wstg": "BUSL-06",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.10.7",
                "label": "Test Defenses Against Application Misuse",
                "labelfa": "آزمون دفاع در برابر عدم استفاده مناسب برنامه کاربردی",
                "wstg": "BUSL-07",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.10.8",
                "label": "Test Upload of Unexpected File Types",
                "labelfa": "آزمون بارگذاری انواع فایل‌های غیرمجاز",
                "wstg": "BUSL-08",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.10.9",
                "label": "Test Upload of Malicious Files",
                "labelfa": "آزمون بارگذاری فایل‌های مخرب",
                "wstg": "BUSL-09",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.10.10",
                "label": "Test Payment Functionality",
                "labelfa": "آزمون عملکرد پرداخت",
                "wstg": "BUSL-10",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b424"
    },
    {
        "id": "4.11",
        "label": "Client-side Testing",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.11.1",
                "label": "Testing for DOM-Based Cross Site Scripting",
                "labelfa": "آزمون XSS مبتنی بر مدل DOM",
                "wstg": "CLNT-11-01",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.2",
                "label": "Testing for JavaScript Execution",
                "labelfa": "آزمون اجرای اسکریپت جاوا",
                "wstg": "CLNT-02",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.3",
                "label": "Testing for HTML Injection",
                "labelfa": "آزمون تزریق HTML",
                "wstg": "CLNT-03",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.4",
                "label": "Testing for Client-side URL Redirect",
                "labelfa": "آزمون تغییر مسیر URL سمت کاربر",
                "wstg": "CLNT-04",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.5",
                "label": "Testing for CSS Injection",
                "labelfa": "آزمون تزریق CSS",
                "wstg": "CLNT-05",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.6",
                "label": "Testing for Client-side Resource Manipulation",
                "labelfa": "آزمون دستکاری منابع سمت کاربر",
                "wstg": "CLNT-06",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.7",
                "label": "Testing Cross Origin Resource Sharing",
                "labelfa": "آزمون CORS",
                "wstg": "CLNT-07",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.8",
                "label": "Testing for Cross Site Flashing",
                "labelfa": "آزمون بهره‌کشی از برنامه‌های کاربردی(CSF)",
                "wstg": "CLNT-08",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.9",
                "label": "Testing for Clickjacking",
                "labelfa": "آزمون Click Jacking",
                "wstg": "CLNT-09",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.10",
                "label": "Testing WebSockets",
                "labelfa": "آزمون WebSockets",
                "wstg": "CLNT-10",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.11",
                "label": "Testing Web Messaging",
                "labelfa": "آزمون پیام رسانی تحت وب",
                "wstg": "CLNT-11",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.12",
                "label": "Testing Browser Storage",
                "labelfa": "آزمون Storage مرورگر",
                "wstg": "CLNT-12",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.13",
                "label": "Testing for Cross Site Script Inclusion",
                "labelfa": "آزمون گنجاندن اسکریپت درون سایت",
                "wstg": "CLNT-13",
                "status": "notAttempted",
                "children": []
            },
            {
                "id": "4.11.14",
                "label": "Testing for Reverse Tabnabbing",
                "labelfa": "آزمون Tabnabbing معکوس",
                "wstg": "CLNT-14",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b425"
    },
    {
        "id": "4.12",
        "label": "API Testing",
        "wstg": null,
        "status": "notAttempted",
        "children": [
            {
                "id": "4.12.1",
                "label": "Testing GraphQL",
                "labelfa": "آزمون GraphQL",
                "wstg": "APIT-01",
                "status": "notAttempted",
                "children": []
            }
        ],
        "_id": "68700eb39473b8a16829b426"
    }
]


import  { useState, useEffect } from 'react';
import { useParams } from 'react-router';
import styled, { keyframes } from 'styled-components';
import { useUserId } from "../../../hooks/useUserId";
import { getBugs } from '../../../api/bugs/getBugs';



const slideDown = keyframes`
  from { max-height: 0; opacity: 0; }
  to { max-height: 1000px; opacity: 1; }
`;

// Styled Components
const Container = styled.div`
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  max-width: 1600px;  // Increased from 1500px
  margin: 2rem auto;
  padding: 1rem 1rem;  // Increased side padding
  background: #ffffff;
  border-radius: 16px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
`;

const Header = styled.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 0;
  margin-bottom: 1.5rem;
  border-bottom: 1px solid #f1f5f9;
`;

const Title = styled.h1`
  color: #0f172a;
  font-weight: 700;
  margin: 0;
  font-size: 1.75rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
`;

const ControlsContainer = styled.div`
  display: flex;
  gap: 1.5rem;
  align-items: center;
`;

const SearchInput = styled.input`
  padding: 0.75rem 1.25rem;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  min-width: 600px;  // Increased from 500px
  font-size: 0.9375rem;
  transition: all 0.2s ease;
  background-color: #f8fafc;
  
  &:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    background-color: white;
  }
`;

const FilterSelect = styled.select`
  padding: 0.75rem 1.25rem;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 0.9375rem;
  cursor: pointer;
  transition: all 0.2s ease;
  background-color: #f8fafc;
  
  &:hover {
    border-color: #cbd5e1;
  }
  
  &:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
  }
`;

const ProgressContainer = styled.div`
  width: 100%;
  background: #f1f5f9;
  border-radius: 8px;
  height: 10px;
  margin: 1.5rem 0;
  overflow: hidden;
`;

const ProgressBar = styled.div`
  height: 100%;
  background: linear-gradient(90deg, #4f46e5, #7c3aed);
  border-radius: 8px;
  width: ${props => props.progress}%;
  transition: width 0.5s ease;
`;

const ProgressText = styled.div`
  text-align: right;
  font-size: 0.875rem;
  color: #64748b;
  margin-top: 0.5rem;
`;

const BulkActions = styled.div`
  display: flex;
  gap: 1rem;
  margin-bottom: 1.5rem;
`;

const Button = styled.button`
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  font-weight: 500;
  font-size: 0.9375rem;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  
  &.primary {
    background: #4f46e5;
    color: white;
    
    &:hover {
      background: #4338ca;
    }
  }
  
  &.secondary {
    background: #f1f5f9;
    color: #334155;
    
    &:hover {
      background: #e2e8f0;
    }
  }
  
  &.success {
    background: #dcfce7;
    color: #166534;
    
    &:hover {
      background: #bbf7d0;
    }
  }
  
  &.danger {
    background: #fee2e2;
    color: #b91c1c;
    
    &:hover {
      background: #fecaca;
    }
  }
`;

const ItemContainer = styled.div`
  margin-bottom: 0.5rem;
  background: ${props => props.depth === 0 ? 'white' : 'transparent'};
  border-radius: ${props => props.depth === 0 ? '12px' : '0'};
  padding: ${props => props.depth === 0 ? '0.5rem' : '0'};
  box-shadow: ${props => props.depth === 0 ? '0 2px 4px rgba(0,0,0,0.05)' : 'none'};
  width: 100%;
  transition: all 0.3s ease;
`;

const ItemHeader = styled.div`
  display: flex;
  align-items: center;
  padding: 1rem 1.25rem;
  cursor: ${props => props.hasChildren ? 'pointer' : 'default'};
`;

const ExpandButton = styled.button`
  width: 0px;
  height: 0px;
  border: none;
  background: #e2e8f0;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  cursor: pointer;
  transition: all 0.2s ease;
  color: #475569;
    padding : 20px
  &:hover {
    background: #cbd5e1;
  }
`;

const ExpandSpacer = styled.span`
  width: 38px;
  margin-right: 1rem;
`;

const ItemLabel = styled.span`
  flex-grow: 1;
  padding: 0 1rem;  // Increased padding
  white-space: normal;
  overflow: visible;
  word-break: break-word;
  min-width: 400px;  // Minimum width for better label display
  max-width: 800px;  // Maximum width to prevent excessive stretching
`;

const ItemControls = styled.div`
  width: 600px;  // Increased from 600px
  flex-shrink: 0;
  display: flex;
  gap: 1.5rem;  // Increased gap between radio groups
  align-items: center;
  margin-left: auto;
`;

const RadioGroup = styled.div`
  display: flex;
  gap: 1.25rem;  // Slightly increased gap
  align-items: center;
  flex-wrap: wrap;  // Allow wrapping if needed
`;

const RadioLabel = styled.label`
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  color: #475569;
  font-size: 0.875rem;
  transition: color 0.2s ease;
  
  &:hover {
    color: #334155;
  }
  
  input[type="radio"] {
    appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid #cbd5e1;
    border-radius: 50%;
    transition: all 0.2s ease;
    cursor: pointer;
    
    &:checked {
      border-color: ${props => 
        props.value === 'pass' ? '#16a34a' : 
        props.value === 'failed' ? '#dc2626' :
        props.value === 'notAccessible' ? '#d97706' :
        '#7c3aed'};
      background: ${props => 
        props.value === 'pass' ? '#dcfce7' : 
        props.value === 'failed' ? '#fee2e2' :
        props.value === 'notAccessible' ? '#fef3c7' :
        '#f3e8ff'};
      box-shadow: inset 0 0 0 5px ${props => 
        props.value === 'pass' ? '#16a34a' : 
        props.value === 'failed' ? '#dc2626' :
        props.value === 'notAccessible' ? '#d97706' :
        '#7c3aed'};
    }
  }
`;

const ChildrenContainer = styled.div`
  animation: ${slideDown} 0.3s ease-out;
  overflow: hidden;
  margin-left: 1.5rem;
`;

const TestDataView = () => {
  const [expandedItems, setExpandedItems] = useState({});
  const [selectedItems, setSelectedItems] = useState({});
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState('all');
  const [progress, setProgress] = useState(0);
  const [data , setData] = useState(); 

  const { id: projectId } = useParams();
  const userId = useUserId();

    useEffect(() => {
      const fetchBugs = async () => {
        try {
          const data = await getBugs(projectId, userId);
          const bugTree = data[0].bugScopes; 
          console.log("bugTree : " , bugTree )
          // const updatedBugTree = bugTree.map(bug => ({ 
          //   ...bug, 
          //   status: STATUS_OPTIONS.some(opt => opt.value === bug.status) ? bug.status : undefined
          // }));
          setData(bugTree);
          // if (data.startDate) {
          //   setStartDate(data.startDate);
          // }
          // setProgress(calculateProgress(updatedBugTree));
        } catch (error) {
          console.error('Failed to fetch bug status:', error);
        } 
      };
      
      fetchBugs();
    }, [projectId, userId]);
  


  // Calculate progress based on completed items
useEffect(() => {
  // Get all leaf nodes (actual testable items)
  const testableItems = flattenData(data)?.filter(item => !item.children || item.children.length === 0);
  const totalItems = testableItems.length;

  // Count completed items (any status selection)
  const completedItems = testableItems?.filter(
    item => selectedItems[item.id] && 
           ['pass', 'failed', 'notApplicable', 'notAccessible'].includes(selectedItems[item.id])
  ).length;

  const newProgress = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;
  setProgress(newProgress);
}, [selectedItems]);


  // Flatten data for progress calculation
  const flattenData = (items) => {
    let flatItems = [];
    items?.forEach(item => {
      flatItems.push(item);
      if (item.children) {
        flatItems = [...flatItems, ...flattenData(item.children)];
      }
    });
    return flatItems;
  };

  const filterData = (items, searchTerm, statusFilter) => {
    return items
      ?.map(item => {
        const newItem = {...item};
        if (newItem.children) {
          newItem.children = filterData(newItem.children, searchTerm, statusFilter);
        }
        return newItem;
      })
      ?.filter(item => {
        const hasMatchingChildren = item.children && item.children.length > 0;
        const matchesSearch = searchTerm === '' || 
          item.label.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesStatus = statusFilter === 'all' || 
          (selectedItems[item.id] || 'notAttempted') === statusFilter;
        
        return (matchesSearch && matchesStatus) || hasMatchingChildren;
      });
  };

  const toggleExpand = (id) => {
    setExpandedItems(prev => ({
      ...prev,
      [id]: !prev[id]
    }));
  };

  const handleRadioChange = (id, value) => {
    setSelectedItems(prev => ({
      ...prev,
      [id]: value
    }));
  };

  const handleSelectAll = () => {
    const allIds = flattenData(data).map(item => item.id);
    const newSelectedItems = {};
    allIds.forEach(id => {
      newSelectedItems[id] = 'pass';
    });
    setSelectedItems(newSelectedItems);
  };

  const handleDeselectAll = () => {
    setSelectedItems({});
  };

  const renderItem = (item, depth = 0) => {
    const hasChildren = item.children && item.children.length > 0;
    const isExpanded = expandedItems[item.id];
    const currentSelection = selectedItems[item.id] || 'notAttempted';
    
    return (
      <ItemContainer key={item.id} depth={depth}>
        <ItemHeader 
          hasChildren={hasChildren} 
          onClick={() => hasChildren && toggleExpand(item.id)}
        >
          {hasChildren ? (
            <ExpandButton>
              {isExpanded ? '▼' : '►'}
            </ExpandButton>
          ) : (
            <ExpandSpacer />
          )}
          
          <ItemLabel depth={depth}>
            {item.label}
          </ItemLabel>
          
          <ItemControls>
            {!hasChildren && (
              <RadioGroup>
                <RadioLabel value="pass">
                  <input
                    type="radio"
                    name={`select-${item.id}`}
                    checked={currentSelection === 'pass'}
                    onChange={() => handleRadioChange(item.id, 'pass')}
                  />
                  Pass
                </RadioLabel>
                <RadioLabel value="failed">
                  <input
                    type="radio"
                    name={`select-${item.id}`}
                    checked={currentSelection === 'failed'}
                    onChange={() => handleRadioChange(item.id, 'failed')}
                  />
                  Failed
                </RadioLabel>
                <RadioLabel value="notAccessible">
                  <input
                    type="radio"
                    name={`select-${item.id}`}
                    checked={currentSelection === 'notAccessible'}
                    onChange={() => handleRadioChange(item.id, 'notAccessible')}
                  />
                  Not Accessible
                </RadioLabel>
                <RadioLabel value="notApplicable">
                  <input
                    type="radio"
                    name={`select-${item.id}`}
                    checked={currentSelection === 'notApplicable'}
                    onChange={() => handleRadioChange(item.id, 'notApplicable')}
                  />
                  Not Applicable
                </RadioLabel>
              </RadioGroup>
            )}
          </ItemControls>
        </ItemHeader>
        
        {hasChildren && isExpanded && (
          <ChildrenContainer>
            {item.children.map(child => renderItem(child, depth + 1))}
          </ChildrenContainer>
        )}
      </ItemContainer>
    );
  };

  return (
    <Container>
      <Header>
       
        <ControlsContainer>
          <SearchInput 
            type="text" 
            placeholder="Search tests..." 
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
          
          <FilterSelect
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
          >
            <option value="all">All Statuses</option>
            <option value="pass">Pass</option>
            <option value="failed">Failed</option>
            <option value="notAccessible">Not Accessible</option>
            <option value="notApplicable">Not Applicable</option>
          </FilterSelect>
        </ControlsContainer>
      </Header>
      
      <ProgressContainer>
        <ProgressBar progress={progress} />
      </ProgressContainer>
      <ProgressText>{progress}% Completed</ProgressText>
      
      <BulkActions>
        <Button className="success" onClick={handleSelectAll}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 12H16M12 8V16M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
          </svg>
          Select All (Pass)
        </Button>
        <Button className="secondary" onClick={handleDeselectAll}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M16 8L8 16M8 8L16 16M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
          </svg>
          Clear All
        </Button>
      </BulkActions>
      
      <div>
        {filterData(data, searchTerm, statusFilter)?.map(item => renderItem(item))}
      </div>
    </Container>
  );
};

export default TestDataView;